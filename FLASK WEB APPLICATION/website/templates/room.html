{% extends "base.html" %}
{% block content%}




<style>
  /* body {
    background-size: cover;
    background-blend-mode: multiply;
    background-image: linear-gradient(rgba(174, 174, 201, 0.9), rgba(0, 0, 0, 0.9)), url({{ url_for('static', filename='images/all.jpg') }});
  } */
</style>


<div class="bigButtonContainer">
  <div class="headerSpace"></div>

  {% for module in modules['lights'] %}
  <div id="blindControl">
    <div class="configContainer">
      <div class="flex">

        <div class="controlLeft">
          <div class="lightBulb" id="{{loop.index}}">
          </div>
          <button onclick="lightOn({{loop.index}})" class="controlButton">
            <div class="buttonFont">ON</div>
          </button>
        </div>

        <div class="controlRight">

          <div class="controlHeader">
            <div>&nbsp;Licht {{loop.index}}</div>
            <div>aus&nbsp;</div>
          </div>

          <div class="configButtons">
            <button id="automatic{{module.port}}" onclick="automatic({{module.port}}), switchButtonClass(id)" class="automaticButton{{module.auto}}">AUTOMATIK</button>
            <button class="automaticButtonFalse">Schwellwert</button>
          </div>

        </div>
      </div>
    </div>
  </div>
  {% endfor %}

  {% for module in modules['blinds'] %}
  <div id="blindControl">
    <div class="configContainer">
      <div class="flex">

        <div class="controlLeft">
          <button onclick="lockButton(id)"  class="controlButton" id="driveUp{{module.port}}">
            <div class="buttonArrow">&#x003C;</div>
          </button>
          <button onclick="lockButton(id)" class="controlButton" id="driveDown{{module.port}}">
            <div class="buttonArrow">&#x003E;</div>
          </button>
        </div>

        <div class="controlRight">

          <div class="controlHeader">
            <div>&nbsp;Rollo {{loop.index}}</div>
            <div>0%&nbsp;</div>
          </div>

          <div class="configButtons">
            <button id="automatic{{module.port}}" onclick="automatic({{module.port}}), switchButtonClass(id)" class="automaticButton{{module.auto}}">AUTOMATIK</button>
            <button class="automaticButtonFalse">Zeitplan</button>
          </div>

        </div>
      </div>
    </div>
  </div>
  {% endfor %}

</div>

<!-- <script>
  let lockedButtonId = null;
  let pressTimer = null;

  function startPressTimer(buttonIdToLock, buttonIdToUnlock) {
    pressTimer = setTimeout(function() {
      // Langer Druck
      lockButton(buttonIdToLock, buttonIdToUnlock);
    }, 300);
  }

  function endPressTimer() {
    clearTimeout(pressTimer);
  }

  function lockButton(buttonIdToLock, buttonIdToUnlock) {
    if (lockedButtonId === buttonIdToLock) {
      // Wenn der Button bereits eingerastet ist, dann aufheben
      unlockButton(buttonIdToLock);
    } else {
      // Anderen Button aufheben (falls eingerastet)
      if (lockedButtonId) {
        unlockButton(lockedButtonId);
      }

      // Button einrasten
      lockButtonStyle(buttonIdToLock);
      unlockButtonStyle(buttonIdToUnlock);
      lockedButtonId = buttonIdToLock;
    }
  }

  function unlockButton(buttonId) {
    unlockButtonStyle(buttonId);
    lockedButtonId = null;
  }

  function lockButtonStyle(buttonId) {
    let button = document.getElementById(buttonId);
    button.classList.remove("controlButton");
    button.classList.add("buttonLocked");
  }

  function unlockButtonStyle(buttonId) {
    let button = document.getElementById(buttonId);
    button.classList.remove("buttonLocked");
    button.classList.add("controlButton");
  }
</script> -->

<script>

  function automatic(port) {
    $.ajax({
        url: "/autoOnOff",
        type: 'POST',
        data: {"port": port},
        success: function (response) {
            console.log(response);
        },
        error: function(error) {
          console.error(error);
        }
    })
  }

  function switchButtonClass(id) {
    button = document.getElementById(id);
    if (button.classList.contains("automaticButtonTrue")) {
      button.classList.remove("automaticButtonTrue");
      button.classList.add("automaticButtonFalse");
    } else {
      button.classList.remove("automaticButtonFalse");
      button.classList.add("automaticButtonTrue");
    }
  }

  function lightOn(id) {
    let lightBulb = document.getElementById(id);
    lightBulb.classList.add("lightBulbOn");
  }

  function lockButton(buttonID) {
    let pressTimer;
    let buttonLocked = false;
    let button = document.getElementById(buttonID);
    button.addEventListener("mousedown", function () {
      pressTimer = setTimeout(function () {
        // long press
        console.log("Langer Druck");
        button.classList.remove("buttonLocked");
        button.classList.add("controlButton");
        buttonLocked = false;
      }, 500);

      // short press
      if (!buttonLocked) {
        button.classList.remove("controlButton");
        button.classList.add("buttonLocked");
        buttonLocked = true;
        console.log(buttonLocked);
      } else {
        button.classList.remove("buttonLocked");
        button.classList.add("controlButton");
        buttonLocked = false;
      }
    });

    button.addEventListener("mouseup", function () {
      clearTimeout(pressTimer);
    });
  }
</script>


<!-- <script>
    envName = "";
    buttonID = document.getElementById("")
    changeClass(buttonID, envName);
  </script> -->
<!-- % endfor % -->

</div>


{% endblock %}